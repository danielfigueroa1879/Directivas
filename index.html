<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Plataforma OS10 Coquimbo</title>
    <meta name="description" content="Plataforma de trámites y servicios de seguridad privada. Requisitos para Directivas de Funcionamiento, Credenciales y más. OS10 Coquimbo.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff"/>
    <link rel="manifest" href="manifest.json">
    <meta name="application-name" content="Directivas OS10">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Directivas OS10">

    <!-- Preconnecting to essential origins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">

    <!-- =========== OPTIMIZATION START: LCP & CSS CRÍTICO =========== -->
    <!-- Preloading critical assets to improve LCP -->
    <!-- Le damos prioridad a la imagen de fondo inicial -->
    <link rel="preload" href="assets/images/foto%20(1).webp" as="image" fetchpriority="high">
    <link rel="preload" href="assets/css/styles.css" as="style">
    <!-- Cargamos el CSS crítico de la homepage aquí para evitar que la carga externa lo bloquee -->
    <style>
        /* Estilos críticos para LCP (fondo de la sección homepage) */
        .homepage-section {
            background-image: url('assets/images/foto%20(1).webp');
            background-size: cover;
            background-position: center 40%;
            transition: background-image 5.5s ease-in-out;
        }
        body.homepage {
            background-color: white; 
            background-image: none;
        }
        /* Estilos para el banner de instalación PWA */
        .pwa-install-banner {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            background-color: #f1f5f9; 
            border-bottom: 2px solid #3b82f6;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1100;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.5s ease-in-out;
            transform: translateY(-100%);
            opacity: 0;
        }
        .pwa-install-banner.show {
            transform: translateY(0);
            opacity: 1;
        }
        /* Estilos de notificaciones */
        .notification-banner {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translate(-50%, -100%); 
            width: 100%; 
            max-width: 750px;
            background-color: #51a351; 
            color: white;
            padding: 1.3rem 2.0rem;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1300; 
            text-align: center;
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s ease-in-out;
        }
        .notification-banner.show {
            transform: translate(-50%, 0); 
            opacity: 1;
        }
        @media (max-width: 768px) {
            .notification-banner {
                width: 100%;
                border-radius: 0 0 0 0;
            }
        }
        .mover-derecha {
            margin-left: 25px; 
        }
        /* Estilos de menú (necesarios para evitar CLS) */
        .submenu-arrow {
            width: 1rem;
            height: 1rem;
            transition: transform 0.3s ease;
        }
        .has-submenu.submenu-open .submenu-arrow {
            transform: rotate(180deg); 
        }
        .submenu-title {
            font-weight: bold;
            padding: 6px 20px; 
            font-size: 0.85rem;
            color: #1f2937; 
            background-color: rgba(243, 244, 246, 0.7); 
            border-top: 1px solid rgba(229, 231, 235, 0.5);
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
        }
        .submenu .submenu-title:first-child {
            border-top: none;
        }
    </style>
    <!-- =========== OPTIMIZATION END =========== -->

    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="assets/images/icon-192x192.webp">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Optimized font loading -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- External stylesheet for non-critical styles (will be loaded non-blockingly) -->
    <link rel="stylesheet" href="assets/css/styles.css?v=4">
</head>
<body class="homepage background-transition">
<!-- PWA Install Banner -->
<div id="pwa-install-banner" class="pwa-install-banner md:hidden">
    <span class="text-gray-800 text-sm font-medium">Instala la aplicación para un acceso más rápido.</span>
    <div class="flex items-center space-x-2">
        <button id="install-button" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-sm">Instalar</button>
        <button id="close-install-banner" class="text-gray-500 hover:text-gray-800 p-1 rounded-full">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
</div>
    <!-- Banner superior -->
    <div id="banner" class="fixed top-0 left-0 right-0 z-[1200] bg-white/35 backdrop-blur-md border-b border-white/30 h-16 flex items-center justify-center shadow-sm">
        <div class="w-full max-w-full md:max-w-6xl mx-auto h-full flex items-center justify-between px-4 relative">
            
            <!-- Contenedor del menú para PC (horizontal) y móvil (botón) -->
            <div class="flex items-center">
                <!-- Botón de menú para móvil -->
                <button id="mobile-menu-btn" class="md:hidden font-medium hover:text-blue-600 transition-colors cursor-pointer flex items-center banner-text-small p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <!-- Menú horizontal para PC -->
                <nav id="desktop-menu" class="hidden md:flex items-center space-x-6 text-sm">
                    
                    <a href="#" onclick="showHomepage()" class="flex items-center space-x-2 font-bold text-gray-700 hover:text-blue-600">
                        <img src="assets/images/logo-os10.webp" alt="OS10 Logo" class="h-8 w-8" loading="lazy">
                        <span>Inicio</span>
                    </a>

                    <!-- Item 1: Trámites -->
                    <div class="relative group">
                        <button class="menu-item">Trámites<svg class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                        <div class="desktop-dropdown">
                            <button onclick="handleDirectiva()">Directiva</button>
                            <button onclick="handleCredenciales()">Credenciales</button>
                            <button onclick="handleCredencialIndependiente()">Credencial Independiente</button>
                            <button onclick="handleValores()">Valores</button>
                            <button onclick="handleValorPlan()">Valor Plan</button>
                        </div>
                    </div>

                    <!-- Item 2: Documentos -->
                    <div class="relative group">
                        <button class="menu-item">Documentos<svg class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                        <div class="desktop-dropdown">
                             <div class="has-submenu relative">
                                <button class="submenu-parent-btn">Doc. Editables</button>
                                <div class="submenu">
                                    <button onclick="openNewLink('https://bit.ly/3QbfmlT')">Estudio de seguridad</button>
                                    <button onclick="openNewLink('https://d6.short.gy/Pl4n')">Planes de seguridad</button>
                                </div>
                            </div>
                            <div class="has-submenu relative">
                                <button class="submenu-parent-btn">Modelos Solicitud</button>
                                <div class="submenu">
                                    <button onclick="openNewLink('https://www.zosepcar.cl/content/OS10/MOD_dec_jurada_pers_naturales.pdf')">1. Pers. Natural</button>
                                    <button onclick="openNewLink('https://www.zosepcar.cl/content/OS10/MOD_dec_jurada_empresas.pdf')">2. Empresas</button>
                                </div>
                            </div>
                            <div class="has-submenu relative">
                                <button class="submenu-parent-btn">Manuales</button>
                                <div class="submenu">
                                     <button onclick="openNewLink('https://www.zosepcar.cl/content/OS10/manual_funcionamiento.pdf')">1. Funcionamiento</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Item 3: Capacitación -->
                    <div class="relative group">
                        <button class="menu-item">Capacitación<svg class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                        <div class="desktop-dropdown">
                           <button onclick="openNewLink('https://d6.short.gy/Cap')">Empresas Capacitación</button>
                           <button onclick="openNewLink('https://drive.google.com/file/d/1hpZrzhXCnGyLkFLRhj0FOY_zDwTEUIaN/view')">Capacitadores</button>
                        </div>
                    </div>

                    <!-- Item 4: Normativa -->
                    <div class="relative group">
                        <button class="menu-item">Normativa<svg class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                        <div class="desktop-dropdown">
                            <div class="has-submenu relative">
                                <button class="submenu-parent-btn">Leyes</button>
                                <div class="submenu">
                                    <button onclick="openNewLink('https://www.bcn.cl/leychile/navegar?idNorma=242302')">1. Constitución</button>
                                    <button onclick="openNewLink('https://www.bcn.cl/leychile/navegar?idNorma=1202067&tipoVersion=0')">2. Ley 21.659</button>
                                </div>
                            </div>
                             <div class="has-submenu relative">
                                <button class="submenu-parent-btn">Decretos</button>
                                <div class="submenu">
                                    <button onclick="openNewLink('https://www.zosepcar.cl/content/OS10/Decreto-261.pdf')">1. D.E. 261 (2020)</button>
                                    <button onclick="openNewLink('https://www.bcn.cl/leychile/navegar?idNorma=1200633')">2. D.E. 32 (2024)</button>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- Item 5: Consultas -->
                     <div class="relative group">
                        <button class="menu-item">Consultas<svg class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                        <div class="desktop-dropdown">
                           <button onclick="handleCerofilas()">Cerofilas</button>
                           <button onclick="handleBuscarCurso('https://www.zosepcar.cl/OS10.php#buscador')">Consultar Curso</button>
                           <button onclick="openNewLink('https://maps.app.goo.gl/QUhujWbTF1FjDA7E6')">Ubicación</button>
                        </div>
                    </div>
                </nav>
            </div>
            
            <a id="os10-home-btn-center" class="hidden md:flex font-bold text-gray-700 banner-text-small cursor-pointer hover:text-blue-600 transition-colors os10-coquimbo-center absolute left-1/2 -translate-x-1/2">
                O.S.10 COQUIMBO
            </a>

            <div class="flex items-center text-xs space-x-2">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
                <span class="banner-text-small">Visitas: <span id="visit-counter" class="font-bold visit-counter-number">--</span></span>
            </div>
        </div>
    </div>

    <!-- Menú desplegable para móvil -->
    <div id="mobile-dropdown" class="mobile-dropdown hidden">
         <div class="dropdown-menu-header"><h3>Menú Principal</h3></div>
         <div class="dropdown-menu-content">
             <div class="has-submenu">
                 <button class="submenu-parent-btn">Trámites<svg class="submenu-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"></path></svg></button>
                 <div class="submenu">
                     <button onclick="handleDirectiva()">Directiva</button>
                     <button onclick="handleCredenciales()">Credenciales</button>
                 </div>
             </div>
             <div class="has-submenu">
                 <button class="submenu-parent-btn">Documentos<svg class="submenu-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"></path></svg></button>
                 <div class="submenu">
                     <button onclick="openNewLink('https://bit.ly/3QbfmlT')">Estudio de seguridad</button>
                 </div>
             </div>
             <button onclick="handleCerofilas()">Cerofilas</button>
         </div>
    </div>
    <div id="mobile-menu-overlay" class="hidden"></div>
    
    <!-- Contenido principal -->
    <div id="contenido" class="card-container bg-white/90 backdrop-blur-sm rounded-xl shadow-lg space-y-6 relative p-6" style="display: none;">
        <a href="https://www.zosepcar.cl/OS10.php" target="_blank" aria-label="Visit ZOSEPCAR page" class="logo-os10-container">
            <img src="assets/images/logo-os10.webp" alt="OS10 Logo" class="h-full" loading="lazy" width="60" height="60">
        </a>
        <button id="credenciales-arrow-back-btn" class="hidden" title="Back to Home" onclick="showHomepage()">
            <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 18l-6-6 6-6"></path></svg>
        </button>
        <!-- El resto del contenido de las secciones (main-section, credenciales-section) no cambia -->
         <section id="main-section" class="main-content" style="display: none;">
            <header class="text-center pt-8">
                <div class="flex items-center justify-center space-x-2">
                    <h1 class="text-2xl font-bold text-gray-800">DIRECTIVA DE FUNCIONAMIENTO</h1>
                </div>
                <h2 class="text-lg font-semibold text-gray-600">Instalación - Eventos - Partidos de Fútbol Profesional</h2>
            </header>
            
            <main class="space-y-4">
                <section class="section-card border-blue-500 bg-blue-100/80">
                    <h3 class="font-bold text-blue-800">1&nbsp;- Presentar Directiva DD.FF.</h3>
                    <ul class="list-disc pl-5 text-sm text-gray-700">
                        <li>&nbsp;Vigencia 03 años en instalación.</li>
                        <li>&nbsp;Presentar con 15 días hábiles de anticipación.</li>
                        <li>
                            <a href="https://www.bcn.cl/leychile/navegar?idNorma=9081" target="_blank" class="text-blue-600 hover:underline">Dec. 93/1985</a>,
                            <a href="https://www.zosepcar.cl/content/OS10/Decreto-261.pdf" target="_blank" class="text-blue-600 hover:underline">Dec. 261</a>,
                            <a href="https://www.bcn.cl/leychile/navegar?idNorma=1200633" target="_blank" class="text-blue-600 hover:underline">Dec. 32/2024</a>.
                       </li>
                   </ul>
                </section>
                
                <section class="section-card border-green-500 bg-green-100/80">
                    <h3 class="font-bold text-green-800">2&nbsp;- Documentación a presentar.</h3>
                    <ul class="space-y-4 text-sm text-gray-700">
                        <li>
                            <p> ➢&nbsp;&nbsp;&nbsp;Dos Solicitudes Simple o carta conductora.</p>
                            <a href="https://dal5.short.gy/Solic" target="_blank" class="inline-block mt-1 w-32 text-center px-4 py-1 text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600 transition-colors" title="Descargar Solicitud">Descargar</a>
                        </li>
                        <li>
                            <p>➢&nbsp;&nbsp;&nbsp;Una copia DD.FF. completa.</p>
                            <a href="https://dal5.short.gy/D" target="_blank" class="inline-block mt-1 w-32 text-center px-4 py-1 text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600 transition-colors" title="Descargar Word">Editable</a>
                        </li>
                        <li>
                            <p>➢&nbsp;&nbsp;&nbsp;Requisitos según Tipo:<br> 
                            <span class="mover-derecha">1&nbsp;.- Instalación.</span><br>
                            <span class="mover-derecha">2.- Partidos de futbol Profesional.</span><br>
                            <span class="mover-derecha">3.- Eventos masivos.</span></p>
                            <a href="https://dal5.short.gy/Re24" target="_blank" class="inline-block mt-1 w-32 text-center px-4 py-1 text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600 transition-colors" title="Descargar Requisi.">Descargar</a>
                        </li>
                    </ul>
                </section>
            </main>
        </section>
        <section id="credenciales-section" class="credenciales-section"></section>
    </div>

    <section id="homepage-section" class="homepage-section relative flex flex-col items-center justify-center text-center text-white p-4 overflow-hidden"></section>

    <div id="homepage-content-wrapper">
        <section id="tramites-principales" class="py-16 md:py-24 bg-[#146314] backdrop-blur-sm"></section>
        <section id="nuestra-labor" class="py-16 md:py-24 bg-white"></section>
    </div>

    <footer id="main-footer" class="bg-[#146314] backdrop-blur-sm text-gray-300"></footer>
    
    <div id="chat-widget-container"></div>
    <div id="chat-backdrop" class="hidden fixed inset-0 bg-black/60 z-40"></div>
    <button id="back-to-top" class="hidden fixed bottom-5 right-5"></button>
    
    <script src="assets/js/inicio.js?v=3" defer></script>
    <script src="assets/js/main.js" defer></script>
    <script type="module">
        // FIREBASE SCRIPT (Visit Counter)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, runTransaction } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        const firebaseConfig = { apiKey: "AIzaSyBB2AegLOQ-b6ZGI_cuPycSFJFuRsUlu5U", authDomain: "cuenta-946e2.firebaseapp.com", projectId: "cuenta-946e2", storageBucket: "cuenta-946e2.firebasestorage.app", messagingSenderId: "816979648502", appId: "1:816979648502:web:809beffeea8ba7968031d7", measurementId: "G-RX9KZSC0F4" };
        async function runCounter() {
            const counterSpan = document.getElementById('visit-counter');
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth(app);
                await signInAnonymously(auth);
                const counterRef = doc(db, `page-visits/${firebaseConfig.projectId}/visits/counter`);
                const newCount = await runTransaction(db, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    let count = 1;
                    if (counterDoc.exists()) { count = counterDoc.data().count + 1; transaction.update(counterRef, { count: count }); } else { transaction.set(counterRef, { count: count }); }
                    return count;
                });
                if (counterSpan) counterSpan.textContent = newCount.toLocaleString('es-CL');
            } catch (error) {
                console.error("ERROR: Counter process failed.", error);
                if (counterSpan) counterSpan.textContent = "Error";
            }
        }
        runCounter();
    </script>
    <script src="./rules/chatbot-rules.js" defer></script>
    <script src="assets/js/chatbot.js" defer></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(reg => console.log('✅ SW registered'), err => console.error('❌ SW registration failed', err));
            });
        }
    </script>
</body>
</html>
